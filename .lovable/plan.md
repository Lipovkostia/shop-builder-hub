
# ÐŸÐ»Ð°Ð½: Ð”Ð²Ð° ÑÑ‚Ð¾Ð»Ð±Ñ†Ð° ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¹ Ð² Ð¿Ñ€Ð°Ð¹Ñ-Ð»Ð¸ÑÑ‚Ðµ

## Ð¡Ñ‚Ð°Ñ‚ÑƒÑ: âœ… Ð’Ð«ÐŸÐžÐ›ÐÐ•ÐÐž

## Ð—Ð°Ð´Ð°Ñ‡Ð°
Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð² Ð¿Ñ€Ð°Ð¹Ñ-Ð»Ð¸ÑÑ‚ Ð´Ð²Ð° Ð¾Ñ‚Ð´ÐµÐ»ÑŒÐ½Ñ‹Ñ… ÑÑ‚Ð¾Ð»Ð±Ñ†Ð°:
1. **ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ** (Ð½Ð¾Ð²Ñ‹Ð¹) - Ð´Ð»Ñ Ð²Ñ‹Ð±Ð¾Ñ€Ð° Ð³Ð»Ð°Ð²Ð½Ð¾Ð¹ Ñ€Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒÑÐºÐ¾Ð¹ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ Ð¿ÐµÑ€Ð²Ð¾Ð³Ð¾ ÑƒÑ€Ð¾Ð²Ð½Ñ
2. **ÐŸÐ¾Ð´ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ** (Ñ‚ÐµÐºÑƒÑ‰Ð¸Ð¹ ÑÑ‚Ð¾Ð»Ð±ÐµÑ† "ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸" Ð¿ÐµÑ€ÐµÐ¸Ð¼ÐµÐ½Ð¾Ð²Ð°Ð½) - Ð´Ð»Ñ Ð²Ñ‹Ð±Ð¾Ñ€Ð° Ð´Ð¾Ñ‡ÐµÑ€Ð½Ð¸Ñ… ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¹

## Ð’Ð¸Ð·ÑƒÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚

```
| Ð¤Ð¾Ñ‚Ð¾ | ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ        | ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ          | ÐŸÐ¾Ð´ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ              | Ð•Ð´.Ð¸Ð·Ð¼ |
|------|-----------------|---------------------|---------------------------|--------|
| ðŸ“·   | ÐŸÐ°Ñ€Ð¼ÐµÐ·Ð°Ð½        | [â–¼ Ð¡Ñ‹Ñ€Ñ‹           ]| [Ð¢Ð²Ñ‘Ñ€Ð´Ñ‹Ðµ] [Ð˜Ñ‚Ð°Ð»Ð¸Ñ]        | ÐºÐ³     |
| ðŸ“·   | Ð¥Ð°Ð¼Ð¾Ð½ Ð¡ÐµÑ€Ñ€Ð°Ð½Ð¾   | [â–¼ ÐœÑÑÐ¾           ]| [Ð¥Ð°Ð¼Ð¾Ð½Ñ‹] [Ð˜ÑÐ¿Ð°Ð½Ð¸Ñ]        | ÐºÐ³     |
| ðŸ“·   | Ð¤Ð¸Ð»Ð°Ð´ÐµÐ»ÑŒÑ„Ð¸Ñ     | [â–¼ ÐœÐ¾Ð»Ð¾Ñ‡ÐºÐ°        ]| [ÐœÑÐ³ÐºÐ¸Ð¹ ÑÑ‹Ñ€] [ÐŸÐ¾Ñ€Ñ†Ð¸Ð¾Ð½Ð½Ñ‹Ðµ] | ÐºÐ³     |
```

## Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð½Ñ‹Ðµ ÑÑ‚Ð°Ð¿Ñ‹

### âœ… Ð­Ñ‚Ð°Ð¿ 1: ÐœÐ¸Ð³Ñ€Ð°Ñ†Ð¸Ñ Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ…
- Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¾ Ð¿Ð¾Ð»Ðµ `primary_category_id uuid REFERENCES categories(id)` Ð² Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñƒ `catalog_product_settings`
- Ð¡ÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¼Ð¸Ð³Ñ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ñ‹ (Ð¿ÐµÑ€Ð²Ñ‹Ð¹ ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚ `categories[]` â†’ `primary_category_id`)

### âœ… Ð­Ñ‚Ð°Ð¿ 2: Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ð° InlinePrimaryCategoryCell
- ÐÐ¾Ð²Ñ‹Ð¹ ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚ `src/components/admin/InlinePrimaryCategoryCell.tsx`
- Ð¤Ð¸Ð»ÑŒÑ‚Ñ€ÑƒÐµÑ‚ Ð¸ Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ ÐºÐ¾Ñ€Ð½ÐµÐ²Ñ‹Ðµ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ (`parent_id IS NULL`)
- Ð’Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚ÑŒ ÑÐ±Ñ€Ð¾ÑÐ¸Ñ‚ÑŒ Ð²Ñ‹Ð±Ð¾Ñ€ (ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð¿ÑƒÑÑ‚Ð¾Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ)
- ÐšÐ½Ð¾Ð¿ÐºÐ° ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ Ð½Ð¾Ð²Ð¾Ð¹ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸

### âœ… Ð­Ñ‚Ð°Ð¿ 3: ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ useCatalogProductSettings
- Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¾ Ð¿Ð¾Ð»Ðµ `primary_category_id: string | null` Ð² Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ `CatalogProductSetting`
- ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ñ‹ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸ `formatSetting()` Ð¸ `updateProductSettings()`

### âœ… Ð­Ñ‚Ð°Ð¿ 4: ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ AdminPanel.tsx
- Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½ Ð½Ð¾Ð²Ñ‹Ð¹ ÑÑ‚Ð¾Ð»Ð±ÐµÑ† `primaryCategory` ("ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ")
- ÐŸÐµÑ€ÐµÐ¸Ð¼ÐµÐ½Ð¾Ð²Ð°Ð½ ÑÑ‚Ð¾Ð»Ð±ÐµÑ† `categories` â†’ `subcategories` ("ÐŸÐ¾Ð´ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ")
- ÐŸÐ¾Ð´ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€ÑƒÑŽÑ‚ÑÑ Ð¿Ð¾ Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½Ð¾Ð¹ Ð³Ð»Ð°Ð²Ð½Ð¾Ð¹ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸
- ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ñ‹ `CatalogProductPricing` Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ Ð¸ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸

### âœ… Ð­Ñ‚Ð°Ð¿ 5: ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ BulkEditPanel
- Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð° ÐºÐ½Ð¾Ð¿ÐºÐ° "ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ" Ð´Ð»Ñ Ð¼Ð°ÑÑÐ¾Ð²Ð¾Ð³Ð¾ Ð²Ñ‹Ð±Ð¾Ñ€Ð° Ð³Ð»Ð°Ð²Ð½Ð¾Ð¹ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸
- ÐšÐ½Ð¾Ð¿ÐºÐ° "ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸" Ð¿ÐµÑ€ÐµÐ¸Ð¼ÐµÐ½Ð¾Ð²Ð°Ð½Ð° Ð² "ÐŸÐ¾Ð´ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸" Ð¸ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€ÑƒÐµÑ‚ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð½Ðµ-ÐºÐ¾Ñ€Ð½ÐµÐ²Ñ‹Ðµ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸
- Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½ prop `onBulkSetPrimaryCategory`

## Ð¤Ð°Ð¹Ð»Ñ‹ Ð¸Ð·Ð¼ÐµÐ½Ñ‘Ð½Ð½Ñ‹Ðµ

| Ð¤Ð°Ð¹Ð» | Ð”ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ | ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ |
|------|----------|----------|
| ÐœÐ¸Ð³Ñ€Ð°Ñ†Ð¸Ñ Ð‘Ð” | âœ… Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¾ | Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ `primary_category_id` |
| `src/components/admin/InlinePrimaryCategoryCell.tsx` | âœ… Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¾ | ÐšÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚ Ð²Ñ‹Ð±Ð¾Ñ€Ð° Ð³Ð»Ð°Ð²Ð½Ð¾Ð¹ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ |
| `src/hooks/useCatalogProductSettings.ts` | âœ… Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¾ | Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¾ Ð¿Ð¾Ð»Ðµ Ð² Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ Ð¸ Ð¼ÐµÑ‚Ð¾Ð´Ñ‹ |
| `src/components/admin/types/index.ts` | âœ… Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¾ | Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¾ `primary_category_id` Ð² `CatalogProductPricing` |
| `src/pages/AdminPanel.tsx` | âœ… Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¾ | Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½ ÑÑ‚Ð¾Ð»Ð±ÐµÑ†, Ð¿ÐµÑ€ÐµÐ¸Ð¼ÐµÐ½Ð¾Ð²Ð°Ð½Ð° ÑÑ‚Ð°Ñ€Ð°Ñ ÐºÐ¾Ð»Ð¾Ð½ÐºÐ° |
| `src/components/admin/BulkEditPanel.tsx` | âœ… Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¾ | ÐœÐ°ÑÑÐ¾Ð²Ð¾Ðµ Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð³Ð»Ð°Ð²Ð½Ð¾Ð¹ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ |

## Ð›Ð¾Ð³Ð¸ÐºÐ° Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ð¸Ð¸ Ð¿Ð¾Ð´ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¹

```typescript
// Ð’ ÑÑ‡ÐµÐ¹ÐºÐµ Ð¿Ð¾Ð´ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¹ Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÐ¼ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð´Ð¾Ñ‡ÐµÑ€Ð½Ð¸Ðµ Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð½Ð¾Ð¹ Ð³Ð»Ð°Ð²Ð½Ð¾Ð¹ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸
const subcategoryOptions = categories
  .filter(c => {
    if (effectivePrimaryCategory) {
      return c.parent_id === effectivePrimaryCategory;
    }
    // Ð•ÑÐ»Ð¸ Ð³Ð»Ð°Ð²Ð½Ð°Ñ Ð½Ðµ Ð²Ñ‹Ð±Ñ€Ð°Ð½Ð° - Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Ð²ÑÐµ Ð½Ðµ-ÐºÐ¾Ñ€Ð½ÐµÐ²Ñ‹Ðµ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸
    return c.parent_id !== null;
  })
  .map(c => ({ value: c.id, label: c.name, sort_order: c.sort_order }));
```
