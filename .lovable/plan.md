
# План: Привязка собственного домена к оптовому магазину

## Обзор

Реализация функционала привязки кастомного домена для B2B-витрины, аналогично розничному магазину, но с отдельным полем в базе данных.

## Текущее состояние

- В таблице `stores` уже есть поле `custom_domain` — используется для розничного магазина
- Для оптового магазина отдельного поля нет
- На вкладке "Домен" в `WholesaleSettingsSection` показывается заглушка

## Изменения

### 1. Миграция базы данных

Добавить новое поле в таблицу `stores`:

```sql
ALTER TABLE stores 
ADD COLUMN wholesale_custom_domain TEXT;
```

### 2. Обновление WholesaleSettingsSection

Заменить заглушку на вкладке "Домен" полноценным UI:

- Поле ввода домена (с валидацией и нормализацией)
- Кнопка "Сохранить домен"
- Инструкция по настройке DNS (A-запись → 185.158.133.1)
- Индикатор статуса (настроен/не настроен)
- Примечание о времени применения DNS (до 48 часов)

### 3. Добавление состояния и обработчиков

В компоненте `WholesaleSettingsSection`:

- Добавить `wholesale_custom_domain` в state settings
- Добавить локальный state `customDomain` для формы
- Создать функцию `handleSaveDomain` для сохранения в БД
- Обновить запрос fetch для получения нового поля

### 4. Обновление хука useWholesaleStore

Добавить поле `wholesale_custom_domain` в интерфейс `WholesaleStore` для использования при резолвинге магазина по домену (в будущем).

---

## Техническая реализация

### UI вкладки "Домен"

```text
┌──────────────────────────────────────────────────────────────┐
│  Свой домен                                                  │
│  ─────────────────────────────────────────────────────────── │
│  Подключите собственный домен для оптового магазина          │
│                                                              │
│  Ваш домен                                                   │
│  ┌──────────────────────────────────────────────────────────┐│
│  │ b2b.example.com                                          ││
│  └──────────────────────────────────────────────────────────┘│
│                                                              │
│  [ Сохранить домен ]                                         │
└──────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────┐
│  ℹ️ Настройка DNS                                            │
│  ────────────────────────────────────────────────────────── │
│  Добавьте следующие записи в настройках DNS вашего домена:  │
│                                                              │
│  ┌────────────────────────────────────────────────────────┐ │
│  │ Тип:     A                                              │ │
│  │ Имя:     @ или b2b.example.com                          │ │
│  │ Значение: 185.158.133.1                                 │ │
│  └────────────────────────────────────────────────────────┘ │
│                                                              │
│  Изменения DNS могут занять до 48 часов для применения      │
└──────────────────────────────────────────────────────────────┘

● Домен настроен: b2b.example.com
```

### Файлы для изменения

| Файл | Изменения |
|------|-----------|
| `supabase/migrations/...` | Добавить поле `wholesale_custom_domain` |
| `src/components/admin/WholesaleSettingsSection.tsx` | Заменить заглушку на UI формы |
| `src/hooks/useWholesaleStore.ts` | Добавить поле в интерфейс |

---

## Важные детали

1. **Валидация домена** — привести к нижнему регистру, убрать пробелы, проверить формат
2. **Уникальность домена** — в будущем можно добавить проверку уникальности в БД
3. **DNS-инструкции** — показать IP-адрес Lovable (185.158.133.1) для A-записи
4. **Разделение от розничного домена** — оптовый и розничный магазины могут иметь разные домены
