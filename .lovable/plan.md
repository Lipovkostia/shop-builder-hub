
# План: Супер-админ дашборд с полной статистикой

## Проблема

1. **Данные не отображаются**: Временный логин `1/1` сохраняется в `localStorage`, но не создаёт реальную сессию Supabase. RLS-политики блокируют доступ к таблицам `profiles`, `store_customers` и другим.

2. **Текущий UI не адаптирован для мобильных устройств** и не показывает сводную статистику.

## Текущие данные в базе

| Метрика | Значение |
|---------|----------|
| Продавцов | 10 |
| Покупателей | 14 |
| Магазинов | 22 |
| Каталогов (прайс-листов) | 16 |
| Товаров | 668 |
| Сумма товаров | 1 772 479 ₽ |
| Новых товаров сегодня | 80 |

---

## Решение

### 1. Edge-функция для получения статистики

Создать `super-admin-stats` функцию, которая использует `SUPABASE_SERVICE_ROLE_KEY` для обхода RLS:

```text
GET /super-admin-stats

Response:
{
  "sellers": { "total": 10, "today": 0 },
  "customers": { "total": 14, "today": 0 },
  "stores": { "total": 22, "today": 0 },
  "catalogs": { "total": 16, "today": 0 },
  "products": { "total": 668, "totalSum": 1772479, "today": 80 },
  "activeToday": { "sellers": 3, "customers": 5 }
}
```

### 2. Новый мобильный дашборд

Добавить вкладку "Дашборд" с карточками метрик:

```text
┌─────────────────────────────────────────────┐
│          🛡 Панель супер-администратора      │
│              [Дашборд] [Магазины] [Покупатели]│
├─────────────────────────────────────────────┤
│                                             │
│  ┌─────────────┐  ┌─────────────┐          │
│  │ 👥 Продавцы │  │ 🛒 Покупатели│          │
│  │     10      │  │      14     │          │
│  │   +0 сегодня│  │   +0 сегодня│          │
│  └─────────────┘  └─────────────┘          │
│                                             │
│  ┌─────────────┐  ┌─────────────┐          │
│  │ 🏪 Магазины │  │ 📋 Прайсы   │          │
│  │     22      │  │      16     │          │
│  │   +0 сегодня│  │   товаров:668│          │
│  └─────────────┘  └─────────────┘          │
│                                             │
│  ┌─────────────────────────────┐           │
│  │ 📦 Товаров всего: 668       │           │
│  │ 💰 Сумма: 1 772 479 ₽       │           │
│  │ +80 новых сегодня           │           │
│  └─────────────────────────────┘           │
│                                             │
│  ┌─────────────────────────────┐           │
│  │ 🟢 Активность сегодня       │           │
│  │ Продавцы: 3  Покупатели: 5  │           │
│  └─────────────────────────────┘           │
│                                             │
└─────────────────────────────────────────────┘
```

### 3. Мобильная адаптация

- **Карточки в сетке**: 2 колонки на мобильных, 4 на десктопе
- **Компактные отступы**: Минимальные padding для максимальной информативности
- **Крупные цифры**: Основные значения выделены, прирост мелким шрифтом
- **Иконки**: Визуальное различение типов метрик
- **Цветовые акценты**: Зелёный для прироста, основной цвет для ключевых значений

---

## Технические изменения

### Файлы для создания:

1. **`supabase/functions/super-admin-stats/index.ts`**
   - Получение всех метрик с service_role
   - Подсчёт активности за сегодня через auth_logs

### Файлы для изменения:

2. **`src/pages/SuperAdmin.tsx`**
   - Добавить вкладку "Дашборд" как первую (по умолчанию)
   - Создать компонент `DashboardStats` с карточками
   - Вызов edge-функции для получения статистики
   - Адаптивная CSS-сетка

---

## Дизайн карточек метрик

Каждая карточка содержит:

```text
┌─────────────────────┐
│ 👥 ПРОДАВЦЫ         │  ← заголовок + иконка
│                     │
│       10            │  ← основное значение (крупно)
│                     │
│  +0 за сегодня      │  ← прирост (мелко, зелёный)
└─────────────────────┘
```

**Цветовая схема:**
- Фон карточки: `bg-card` с тенью
- Заголовок: `text-muted-foreground`
- Основное значение: `text-4xl font-bold`
- Прирост: `text-green-500 text-sm`

---

## Порядок реализации

1. Создать edge-функцию `super-admin-stats`
2. Развернуть и протестировать
3. Добавить дашборд UI в SuperAdmin.tsx
4. Протестировать на мобильных устройствах
