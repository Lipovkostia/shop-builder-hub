

# –ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (—Ä–∞–∑–¥–µ–ª—ã) –≤ –≤—ã–ø–∞–¥–∞—é—â–µ–º —Å–ø–∏—Å–∫–µ –≤–∏—Ç—Ä–∏–Ω—ã

## –ß—Ç–æ –±—É–¥–µ—Ç —Å–¥–µ–ª–∞–Ω–æ

–í—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –≤ –∞–¥–º–∏–Ω-–≤–∏—Ç—Ä–∏–Ω–µ (StoreFront) –±—É–¥–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å **—Ä–∞–∑–¥–µ–ª—ã** (—Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏) —Å–æ —Å—Ç—Ä–µ–ª–æ—á–∫–∞–º–∏. –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ —Ä–∞–∑–¥–µ–ª —Ä–∞—Å–∫—Ä—ã–≤–∞—é—Ç—Å—è –µ–≥–æ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏. –í—ã–±–æ—Ä –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç —Ç–æ–≤–∞—Ä—ã. –ü–æ—Ä—è–¥–æ–∫ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ "–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π".

## –ò–∑–º–µ–Ω–µ–Ω–∏—è

### 1. –û–±–Ω–æ–≤–∏—Ç—å RPC `get_catalog_categories_ordered`

–¢–µ–∫—É—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `c.parent_id` –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `categories`, –Ω–æ –∏–µ—Ä–∞—Ä—Ö–∏—è —Ä–∞–∑–¥–µ–ª–æ–≤ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ `catalog_category_settings.parent_category_id`. –ù—É–∂–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –∫–∞—Ç–∞–ª–æ–≥-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–π `parent_category_id`.

**–ß—Ç–æ –º–µ–Ω—è–µ—Ç—Å—è**: –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –ø–æ–ª–µ `parent_category_id` –∏–∑ `catalog_category_settings` –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç RPC.

```sql
RETURNS TABLE (
  id uuid,
  name text,
  slug text,
  image_url text,
  parent_id uuid,
  sort_order integer,
  parent_category_id uuid  -- –Ω–æ–≤–æ–µ –ø–æ–ª–µ
)
...
SELECT 
  c.id,
  COALESCE(ccs.custom_name, c.name) as name,
  c.slug,
  c.image_url,
  c.parent_id,
  COALESCE(ccs.sort_order, c.sort_order, 999999) as sort_order,
  ccs.parent_category_id
FROM categories c
LEFT JOIN catalog_category_settings ccs ...
```

### 2. –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –∫–∞—Ç–µ–≥–æ—Ä–∏–π –≤ `StoreFront.tsx`

–ü—Ä–∏ –º–∞–ø–ø–∏–Ω–≥–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ RPC -- —Å–æ—Ö—Ä–∞–Ω—è—Ç—å `parent_category_id`:

```typescript
setCatalogSpecificCategories(data.map((c: any) => ({
  ...existingFields,
  parent_category_id: c.parent_category_id || null,
})));
```

### 3. –ü–µ—Ä–µ–¥–µ–ª–∞—Ç—å –≤—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π

–í–º–µ—Å—Ç–æ –ø–ª–æ—Å–∫–æ–≥–æ —Å–ø–∏—Å–∫–∞ `DropdownMenuItem` -- –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–π:

- **–†–∞–∑–¥–µ–ª—ã** (–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å `isSection` / —É –∫–æ—Ç–æ—Ä—ã—Ö –µ—Å—Ç—å –¥–æ—á–µ—Ä–Ω–∏–µ) –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∂–∏—Ä–Ω—ã–º —à—Ä–∏—Ñ—Ç–æ–º —Å –∏–∫–æ–Ω–∫–æ–π —Å—Ç—Ä–µ–ª–∫–∏ (ChevronRight / ChevronDown)
- –ü—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —Ä–∞–∑–¥–µ–ª -- —Ä–∞—Å–∫—Ä—ã–≤–∞—é—Ç—Å—è –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å –æ—Ç—Å—Ç—É–ø–æ–º
- –ü—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é -- —Ñ–∏–ª—å—Ç—Ä—É—é—Ç—Å—è —Ç–æ–≤–∞—Ä—ã (setCategoryFilter)
- –ö–ª–∏–∫ –Ω–∞ —Å–∞–º —Ä–∞–∑–¥–µ–ª –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –í–°–ï —Ç–æ–≤–∞—Ä—ã –∏–∑ –≤—Å–µ—Ö –µ–≥–æ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π

–ü–æ—Ä—è–¥–æ–∫ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –±–µ—Ä—ë—Ç—Å—è –∏–∑ `sort_order`, –∫–æ—Ç–æ—Ä—ã–π —É–∂–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç –∏–∑ RPC –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ.

### 4. –û–±–Ω–æ–≤–∏—Ç—å –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ chips-—Ñ–∏–ª—å—Ç—Ä—ã

–¢–∞ –∂–µ –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è chips-–ø–æ–ª–æ—Å—ã: —Ä–∞–∑–¥–µ–ª—ã –∫–∞–∫ –∑–∞–≥–æ–ª–æ–≤–∫–∏, –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–µ chips.

### 5. –û–±–Ω–æ–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é —Ç–æ–≤–∞—Ä–æ–≤

–ö–æ–≥–¥–∞ –≤—ã–±—Ä–∞–Ω **—Ä–∞–∑–¥–µ–ª** (–Ω–µ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è), —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ –≤—Å–µ–º –µ–≥–æ –¥–æ—á–µ—Ä–Ω–∏–º –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º:

```typescript
if (categoryFilter !== null) {
  // –ù–∞–π—Ç–∏ –≤—Å–µ –¥–æ—á–µ—Ä–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ä–∞–∑–¥–µ–ª–∞
  const childIds = catalogCategories
    .filter(c => c.parent_category_id === categoryFilter)
    .map(c => c.id);
  const filterIds = childIds.length > 0 
    ? [categoryFilter, ...childIds] 
    : [categoryFilter];
  
  if (!filterIds.some(id => productCategories.includes(id))) {
    return false;
  }
}
```

### 6. –û–±–Ω–æ–≤–∏—Ç—å –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫—É —Ç–æ–≤–∞—Ä–æ–≤ (–≤–∏–¥ "–í—Å–µ —Ç–æ–≤–∞—Ä—ã")

–ö–æ–≥–¥–∞ –Ω–µ—Ç —Ñ–∏–ª—å—Ç—Ä–∞, —Ç–æ–≤–∞—Ä—ã –≥—Ä—É–ø–ø–∏—Ä—É—é—Ç—Å—è –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º, –≤–Ω—É—Ç—Ä–∏ -- –ø–æ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è–º:

```text
| üìÅ –î–ï–õ–ò–ö–ê–¢–ï–°–´                |
|   ‚îÄ‚îÄ –§—É–∞-–≥—Ä–∞ ‚îÄ‚îÄ              |
|   —Ç–æ–≤–∞—Ä 1, —Ç–æ–≤–∞—Ä 2           |
|   ‚îÄ‚îÄ –ò–∫—Ä–∞ ‚îÄ‚îÄ                 |
|   —Ç–æ–≤–∞—Ä 3                    |
| üìÅ –ù–ê–ü–ò–¢–ö–ò                   |
|   ‚îÄ‚îÄ –í–∏–Ω–æ ‚îÄ‚îÄ                 |
|   —Ç–æ–≤–∞—Ä 4                    |
```

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —á–∞—Å—Ç—å

| –§–∞–π–ª | –ß—Ç–æ –º–µ–Ω—è–µ—Ç—Å—è |
|------|-------------|
| –ú–∏–≥—Ä–∞—Ü–∏—è SQL | –û–±–Ω–æ–≤–∏—Ç—å RPC `get_catalog_categories_ordered` -- –¥–æ–±–∞–≤–∏—Ç—å `parent_category_id` |
| `src/pages/StoreFront.tsx` | (1) –ú–∞–ø–ø–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö RPC -- —Å–æ—Ö—Ä–∞–Ω—è—Ç—å `parent_category_id`. (2) –í—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ -- –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–π —Å expand/collapse. (3) Chips -- –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–µ. (4) –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è -- —É—á–∏—Ç—ã–≤–∞—Ç—å –¥–æ—á–µ—Ä–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏. (5) –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ -- –¥–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤–∞—è. |

–¢–∏–ø `catalogSpecificCategories` –±—É–¥–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω –ø–æ–ª–µ–º `parent_category_id: string | null`. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤–Ω—É—Ç—Ä–∏ StoreFront –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ `expandedSections` (Set) –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞—Å–∫—Ä—ã—Ç–∏–µ–º —Ä–∞–∑–¥–µ–ª–æ–≤ –≤ –¥—Ä–æ–ø–¥–∞—É–Ω–µ.
