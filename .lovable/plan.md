

# Fix: "не число" при импорте прайса через ИИ-помощник

## Проблема

При загрузке прайс-листа через ИИ-помощник, в диалоге "Найдено новых товаров" отображается **"не число ₽"** вместо цены.

## Причина

В файле `NewProductsConfirmDialog.tsx` (строка 76) вызывается:

```typescript
formatPrice(product.buyPrice)
// buyPrice = undefined (цена не была распознана)
// Intl.NumberFormat('ru-RU').format(undefined) → "не число"
```

Когда в Excel-файле ячейка цены пустая или содержит нечисловое значение, `parsePrice` возвращает `0`, и условие `if (parsedPrice > 0)` не срабатывает -- поле `buyPrice` остаётся `undefined`. Далее `Intl.NumberFormat` в русской локали форматирует `undefined` как **"не число"** (аналог NaN).

Вторая проблема: для файлов с форматом цен вроде `"1,700.00"` (запятая как разделитель тысяч) -- xlsx-библиотека может вернуть строку вместо числа, и текущий `parsePrice` должен это обработать корректно. Но для дополнительной надёжности стоит усилить парсер.

## План исправления

### 1. `src/components/admin/NewProductsConfirmDialog.tsx`
- Изменить `formatPrice` для обработки `undefined`, `NaN` и `0`:
  - Если `price` равно `undefined`, `NaN` или `0` -- показывать "—" (прочерк) вместо "не число ₽"

### 2. `src/lib/priceListImport.ts` -- функция `parsePrice`
- Усилить парсер для обработки локализованных форматов чисел:
  - Поддержка запятой как десятичного разделителя (европейский формат: `1.700,00`)
  - Поддержка запятой как разделителя тысяч (формат файла: `1,700.00`)
  - Удаление пробелов, символов валют и прочих нечисловых символов
  - Автоопределение формата по позиции последней точки и запятой

### Итог
- Диалог будет корректно отображать цены или прочерк для товаров без цены
- Парсер станет устойчивее к разным форматам Excel-файлов
