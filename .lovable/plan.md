

# Улучшение окна загрузки прайс-листа -- предпросмотр изменений

## Что изменим

Сейчас после загрузки файла импорт либо сразу запускается (если нет новых товаров), либо показывает маленький диалог с новыми товарами. Пользователь не видит, **что именно будет обновлено** у существующих товаров.

Переделаем процесс: после загрузки файла покажем **большое окно с таблицей предпросмотра**, где видно:
- Какие товары будут обновлены и что именно изменится (старая цена -> новая цена, статус и т.д.)
- Какие товары новые (будут созданы)
- Возможность отменить или подтвердить импорт

## Новый процесс импорта

```text
1. Загрузка файла (drag & drop)
         |
2. Проверка файла (checkCatalogImportProducts)
         |
3. НОВЫЙ ШАГ: Предпросмотр в большой таблице
   +------------------------------------------------------+
   | Предпросмотр импорта               [X]               |
   |------------------------------------------------------|
   | Будет обновлено: 15 | Новых: 3 | Пропущено: 0       |
   |------------------------------------------------------|
   | # | Товар          | Действие    | Цена     | Статус |
   |---|----------------|-------------|----------|--------|
   | 1 | Пармезан       | Обновление  | 300->350 | --     |
   | 2 | Грана Падано   | Обновление  | 200->250 | --     |
   | 3 | Новый сыр      | + Создание  | 500      | --     |
   |------------------------------------------------------|
   |                    [Отмена]  [Импортировать]           |
   +------------------------------------------------------+
```

## Технические детали

### 1. Расширить `checkCatalogImportProducts` (src/lib/excelImport.ts)

Для существующих товаров -- подгружать текущие данные из БД (buy_price, status в catalog_product_settings), чтобы показать разницу "было -> стало".

Добавить в интерфейс `CatalogImportCheck.existingProducts` дополнительные поля:
- `currentBuyPrice` -- текущая себестоимость из products
- `newBuyPrice` -- цена из файла
- `currentStatus` -- текущий статус из catalog_product_settings
- `newStatus` -- статус из файла

### 2. Новый компонент `CatalogImportPreviewDialog` (src/components/admin/CatalogImportPreviewDialog.tsx)

Большой диалог (`sm:max-w-4xl`, `max-h-[85vh]`) с:
- Сводка вверху: количество обновляемых, новых, пропущенных
- Таблица предпросмотра со всеми строками из файла:
  - Столбцы: Название, Действие (Обновление / Создание), Цена (было -> стало), Статус, Наценка
  - Цветовая маркировка: зеленый для новых, синий для обновляемых, серый для пропущенных
- Чекбоксы у новых товаров (как было раньше, но теперь в общей таблице)
- Кнопки "Отмена" и "Импортировать"

### 3. Обновить `CatalogImportDialog` (src/components/admin/CatalogImportDialog.tsx)

- Увеличить размер диалога: `sm:max-w-lg`
- После проверки файла -- вместо прямого запуска импорта или отдельного CatalogNewProductsDialog -- открывать новый `CatalogImportPreviewDialog`
- CatalogNewProductsDialog больше не используется в этом потоке (остается в коде)

### Файлы

1. **`src/lib/excelImport.ts`** -- расширить `checkCatalogImportProducts` для подгрузки текущих цен и статусов существующих товаров
2. **`src/components/admin/CatalogImportPreviewDialog.tsx`** -- новый компонент с большой таблицей предпросмотра
3. **`src/components/admin/CatalogImportDialog.tsx`** -- подключить новый диалог предпросмотра вместо прямого импорта

