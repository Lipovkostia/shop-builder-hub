

# Биржа заявок -- план реализации

## Концепция

Новая вкладка **"Биржа"** в панели управления продавца, где продавцы могут:
1. Создавать заявки на закупку товаров (выбирая из своего ассортимента или добавляя вручную)
2. Просматривать заявки других продавцов и предлагать свои цены (отклики)

## Дизайн и UX

### Структура экрана

Экран "Биржа" разделен на **две вкладки-переключателя** внутри секции:

**Вкладка 1 -- "Мои заявки"** (по умолчанию):
- Кнопка **"+ Новая заявка"** в правом верхнем углу
- Список карточек заявок пользователя (компактные строки):
  - Дата создания | Кол-во позиций | Статус (активна / закрыта) | Кол-во откликов
  - Раскрывается по клику -- показывает таблицу позиций с полученными ценами от поставщиков
- Пустое состояние с иконкой и призывом создать первую заявку

**Вкладка 2 -- "Все заявки"** (биржа):
- Лента заявок от всех продавцов (кроме своих)
- Каждая заявка -- компактная карточка:
  - Город / Дата | Кол-во позиций | Статус
  - По клику раскрывается список позиций, где можно проставить свои цены и отправить предложение
- Фильтры: поиск по названию товара, сортировка по дате

### Создание заявки (диалог)

1. Таблица из ассортимента продавца (поиск + чекбоксы для выбора)
2. Кнопка "Добавить свой товар" -- вводится только название
3. Выбранные позиции отображаются списком снизу
4. Кнопка "Отправить на биржу"

### Отклик на заявку

- Раскрытая карточка чужой заявки показывает список позиций
- Напротив каждой позиции -- поле ввода цены
- Кнопка "Отправить предложение" внизу

## Технический план

### 1. Новые таблицы в базе данных

**`exchange_requests`** -- заявки на бирже:
- `id` (uuid, PK)
- `store_id` (uuid, FK -> stores)
- `created_by` (uuid, FK -> profiles)
- `status` (text: 'active' | 'closed')
- `created_at`, `updated_at`

**`exchange_request_items`** -- позиции заявки:
- `id` (uuid, PK)
- `request_id` (uuid, FK -> exchange_requests)
- `product_id` (uuid, nullable, FK -> products) -- если из ассортимента
- `custom_name` (text) -- если добавлен вручную
- `unit` (text, default 'шт')
- `created_at`

**`exchange_responses`** -- отклики поставщиков:
- `id` (uuid, PK)
- `request_id` (uuid, FK -> exchange_requests)
- `responder_store_id` (uuid, FK -> stores)
- `created_at`

**`exchange_response_items`** -- цены в отклике:
- `id` (uuid, PK)
- `response_id` (uuid, FK -> exchange_responses)
- `request_item_id` (uuid, FK -> exchange_request_items)
- `price` (numeric)

RLS-политики:
- Все авторизованные продавцы могут читать активные заявки
- Создавать заявки может только владелец магазина
- Отклики видны только автору заявки и автору отклика

### 2. Изменения в навигации

- Добавить `"exchange"` в тип `ActiveSection` в `AdminPanel.tsx` и `MobileTabNav.tsx`
- Новый пункт навигации с иконкой `Gavel` (или `ArrowLeftRight`) и подписью **"Биржа"** -- в конце списка

### 3. Новые компоненты

- `src/components/admin/ExchangeSection.tsx` -- основной компонент секции
- `src/components/admin/ExchangeRequestCard.tsx` -- карточка заявки
- `src/components/admin/ExchangeCreateDialog.tsx` -- диалог создания заявки
- `src/components/admin/ExchangeResponseForm.tsx` -- форма отклика с полями цен

### 4. Новый хук

- `src/hooks/useExchange.ts` -- CRUD для заявок, позиций и откликов

### 5. Цветовая схема

- Заявки: карточки с левой зеленой полоской (активные) или серой (закрытые)
- Отклики: бейдж с количеством, акцентный цвет primary
- Компактный стиль, согласованный с остальной панелью администратора

