# SaaS-платформа: мультитенантный магазин

## Архитектура ролей

### Платформенные роли (глобальные)
- **super_admin** — супер-администратор платформы. Имеет доступ ко всем магазинам.

### Бизнес-роли (в контексте магазина)
- **seller** — владелец/администратор магазина
- **customer** — покупатель магазина

## Как назначить супер-администратора

1. Пользователь должен быть зарегистрирован в системе
2. Выполните SQL-запрос в базе данных:

```sql
-- Замените 'user-uuid-here' на реальный user_id из auth.users
INSERT INTO public.platform_roles (user_id, role)
VALUES ('user-uuid-here', 'super_admin');
```

### Как найти user_id пользователя

```sql
-- По email
SELECT id FROM auth.users WHERE email = 'admin@example.com';
```

## Маршруты

- `/super-admin` — панель супер-администратора (только для super_admin)
- `/admin` — админ-панель магазина (для seller и super_admin в контексте магазина)
- `/admin?storeId=xxx` — вход супер-админа в контекст конкретного магазина
- `/auth` — вход/регистрация

## Безопасность

- Роли платформы хранятся в отдельной таблице `platform_roles`
- Используется функция `has_platform_role()` для проверки без рекурсии RLS
- Супер-админ имеет политики для просмотра всех магазинов, товаров и клиентов
- Счётчики товаров и покупателей обновляются автоматически через триггеры
